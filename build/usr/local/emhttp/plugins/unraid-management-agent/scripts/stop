#!/bin/bash

PROG="unraid-management-agent"
running=$(pidof $PROG | wc -w)

# Gracefully stop the application
if [ $running -ge 1 ]; then
  TIMER=0
  while $(killall $PROG 2>/dev/null); do
    sleep 1
    TIMER=$((TIMER + 1))
    if [ $TIMER -ge 30 ]; then
      # Force kill if graceful shutdown takes too long
      killall -9 $PROG
      sleep 1
      break
    fi
  done
  echo "Unraid Management Agent stopped"
else
  echo "Unraid Management Agent was not running"
fi
