<?xml version='1.0' standalone='yes'?>

<!DOCTYPE PLUGIN [
<!ENTITY name        "unraid-management-agent">
<!ENTITY author      "ruaan-deysel">
<!ENTITY version     "2026.03.00">
<!ENTITY launch      "Settings/&name;">
<!ENTITY gitURL      "https://github.com/ruaan-deysel/&name;">
<!ENTITY pluginURL   "&gitURL;/releases/latest/download/&name;.plg">
<!ENTITY bundle      "&name;-&version;.tgz">
<!ENTITY md5         "5f0606dd5f45af61a553ee00e69756ae">
]>

<PLUGIN  name="&name;"
         author="&author;"
         version="&version;"
         launch="&launch;"
         pluginURL="&pluginURL;"
         support="&gitURL;/issues"
         icon="server">

<CHANGES>
###2026.03.00 (2026-03-01)
- 16 New MCP Tools (9 monitoring, 9 control)
- Bug fixes and performance optimizations.

###2026.02.01 (2026-02-14)
- CPU Power Consumption Monitoring
- MCP Streamable HTTP Transport
- MCP STDIO Transport

###2026.02.00 (2026-01-30)
- **Disk Model and Serial Number Population**

###2026.01.02 (2026-01-27)
- **Go 1.25.0 Upgrade**: Upgraded from Go 1.24.0 to 1.25.0 for improved performance and latest language features
- **golangci-lint v2 Migration**: Migrated to golangci-lint v2.8.0 with updated configuration format
- All code quality checks passing with zero tolerance policy
- Added: Prometheus metrics endpoint at /metrics for native Grafana integration (31 metrics covering system, array, disks, Docker, VMs, UPS, shares, network services, GPU)
- Added: Network services status API - monitors 13 services (SMB, NFS, AFP, FTP, SSH, Telnet, Avahi, NetBIOS, WSD, WireGuard, UPnP, NTP, Syslog)
- Added: Global disk temperature thresholds API (HDD and SSD thresholds from dynamix.cfg)
- Added: Per-disk temperature threshold overrides (from individual disk .cfg files)
- Added: Parity check schedule API (frequency, day, time from parity-checks.cron)
- Added: Mover schedule and status API (cron schedule, running status, thresholds)
- Added: Docker and VM service status API (enabled/disabled state)
- Added: OS and plugin update availability API (update status, versions, counts)
- Added: USB flash drive health API (capacity, usage, filesystem info)
- Added: Installed plugins list API (metadata, versions, update availability)
- Added: Share cache pool settings (primary and secondary cache pools)

###2026.01.01 (2026-01-12)
- Fixed: Log file accumulation (MaxBackups=1, MaxAge=1 day, cleanupOldLogs to remove old .gz files)
- Fixed: Dark theme support (UI now uses Unraid CSS variables and inherits colors)
- Changed: Default log level set to "info"; log level now CLI-only (UI option removed)
- Added: Model Context Protocol (MCP) support with 18 monitoring tools, 7 control tools, 5 resources, 3 prompts, new /mcp endpoint
- Added: OpenAPI/Swagger docs with 76 endpoints and "Try it out" at /swagger
- Added: Runtime collector management API (enable/disable/update interval, per-collector status, events)
- Added: Network access URLs endpoint (LAN, mDNS, WireGuard, WAN, IPv6)
- Performance: Docker SDK collector (~530x faster), VM libvirt collector (~100-200x faster), docker batching and skip stopped, UPS/NUT improvements, collectors status API, disable collectors feature, env/CLI flags to disable collectors, extended intervals up to 24h, web UI for intervals, configurable intervals persisted
- Changed: Industry-standard default intervals; start script env passthrough fix
- Fixed: Parity check status detection; disk temperature reporting; power consumption optimization (interval increases, docker batching, intel_gpu_top tuning)
</CHANGES>

<!--
Unraid Management Agent - REST API and WebSocket server for Home Assistant integration.

Exposes comprehensive Unraid system monitoring and control via REST API and WebSockets.
-->

<!-- Get the plugin bundle -->
<FILE Name="/boot/config/plugins/&name;/&bundle;">
<URL>&gitURL;/releases/download/&version;/&bundle;</URL>
</FILE>

<!-- Install default configuration -->
<FILE Name="/boot/config/plugins/&name;/config.cfg">
<INLINE>
<![CDATA[
# Service configuration
SERVICE="enable"

# API configuration
PORT="8043"
ENABLE_CORS="yes"

# Feature toggles
ENABLE_UPS="yes"
ENABLE_GPU="yes"

# Collection intervals (seconds) - Power-optimized defaults (Issue #8)
# Higher intervals reduce CPU wakeups and power consumption
INTERVAL_SYSTEM="15"
INTERVAL_ARRAY="30"
INTERVAL_DISK="30"
INTERVAL_DOCKER="30"
INTERVAL_VM="30"
INTERVAL_UPS="60"
INTERVAL_GPU="60"
INTERVAL_SHARES="60"
INTERVAL_NETWORK="30"
INTERVAL_ZFS="30"
INTERVAL_NOTIFICATION="30"
INTERVAL_HARDWARE="300"
INTERVAL_REGISTRATION="300"
INTERVAL_UNASSIGNED="60"
]]>
</INLINE>
</FILE>

<!-- Installation script -->
<FILE Run="/bin/bash">
<INLINE>
running=$(pidof &name; | wc -w)

# Stop if running
killall &name; 2>/dev/null

# Remove old emhttp files
rm -rf /usr/local/emhttp/plugins/&name;/* 2>/dev/null

# Remove old bundle files
rm -f $(ls /boot/config/plugins/&name;/&name;*.tgz 2>/dev/null | grep -v '&version;.tgz')

# Install the bundle
tar -xf /boot/config/plugins/&name;/&bundle; -C /usr/local/emhttp/plugins

# Make scripts executable
chmod +x /usr/local/emhttp/plugins/&name;/scripts/*
chmod +x /usr/local/emhttp/plugins/&name;/event/*
chmod +x /usr/local/emhttp/plugins/&name;/&name;

# Start if it was running before
if [ $running -eq 1 ]; then
    /usr/local/emhttp/plugins/&name;/scripts/start
fi

echo ""
echo "-----------------------------------------------------------"
echo " &name; has been installed."
echo " Copyright © &author;"
echo " Version: &version;"
echo "-----------------------------------------------------------"
echo ""
</INLINE>
</FILE>

<!-- Removal script -->
<FILE Run="/bin/bash" Method="remove">
<INLINE>
# Stop the service
/usr/local/emhttp/plugins/&name;/scripts/stop

# Remove all plugin files
rm -rf /usr/local/emhttp/plugins/&name;
rm -rf /boot/config/plugins/&name;

echo ""
echo "-----------------------------------------------------------"
echo " &name; has been removed."
echo " Copyright © &author;"
echo " Version: &version;"
echo "-----------------------------------------------------------"
echo ""
</INLINE>
</FILE>

</PLUGIN>
