#!/bin/bash
# Read configuration
source /boot/config/plugins/unraid-management-agent/config.cfg

PROG="/usr/local/emhttp/plugins/unraid-management-agent/unraid-management-agent"
LOGS_DIR="/var/log"

# Stop if it's already running
killall unraid-management-agent >/dev/null 2>&1

# Prepare environment
export PORT="${PORT:-8043}"
export MOCK_MODE="${MOCK_MODE:-false}"

# Run the application
nohup sudo -H bash -c "$PROG --logs-dir $LOGS_DIR --port $PORT" >/dev/null 2>&1 &

echo "Unraid Management Agent started on port $PORT"
